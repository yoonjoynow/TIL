# 명쾌한 설명과 풍부한 그림으로 배우는 TCP/IP 쉽게, 더 쉽게 정리
참고 : [명쾌한 설명과 풍부한 그림으로 배우는 TCP/IP 쉽게, 더 쉽게](https://www.aladin.co.kr/shop/wproduct.aspx?ItemId=91820548)

## 목차
3. 트랜스포트 계층
    - 트랜스포트 계층의 역할
    - 포트 번호
    - TCP가 정확하게 데이터를 전달하는 방법
    - UDP가 고속으로 데이터를 전달하는 방법
    - netstat 명령으로 네트워크의 상태 확인하기
___

## 3. 트랜스포트 계층
### 01 트랜스포트 계층의 역할

- 엔드포인트 간 **신뢰성**이 있는 데이터 **전송**을 담당하하는 계층이다.
- 애플리케이션으로부터 의뢰를 받아 송,수신 동작을 실행한다.
- 여러 컴퓨터로부터 전달받은 데이터들은 이 계층에서 적절히 분류된 이후, 각 데이터들의 목적지에 있는 프로그램을 향해 전달된다.
- 데이터를 애플리케이션에 전달한다.
- 포트번호로 애플리케이션을 구분한다.
- 데이터의 정확한 전달을 중시한다. (데이터의 전송 속도를 중시하는 UDP와 대비) 


#### 어떻게 데이터를 전달하는가?
웹이나 이메일, 파일등과 같이 정확한 데이터 전달이 필요한 통신에 사용되는 프로토콜이 바로 TCP이다.
TCP는 데이터 전송에 신뢰성을 높이기 위해 데이터를 **세그먼트**라는 단위로 분할한다.
이 세그먼트들을 적절한 전송 속도로 클라이언트로 **순차적으로** 전송하며, 데이터가 제대로 전달되지 않았을 경우 **재전송**을 한다.

### 02 포트번호
- 포트번호는 컴퓨터 내부의 수신지를 나타낸다.
- 포트 번호의 범위는 0 ~ 65535번까지이다.

서버측에서 사용하는 포트는 미리 정해져 있다.
반대로, 클라이언트가 사용하는 포트는 다이나믹 포트 번호 대역에서 자동으로 할당돼, 그때그때 다르다.

### 03 TCP가 정확하게 데이터를 전달하는 방법

#### 컨트롤 비트
|플래그|역할|
|:--:|:--:|
|CWR|전송량을 줄일 것을 알림|
|ECE|수신할 수 없을수도 있다는 것을 알림|
|URG|긴급 포인터에서 지정한 데이터를 즉시 처리해야 한다는 것을 알림|
|ACK|이전 동작을 확인했다는 것을 알림|
|PSH|수신 데이터를 즉시 응용계층에 전달해야 함을 알림|
|RST|이상 상황 발생으로 접속이 강제 중단됨을 알림|
|SYN|접속 시작 시 ON으로 설정해 알림|
|FIN|데이터 송신이 완료돼 통신을 종료하고 싶음을 알림|


#### 통신 개시부터 통신 종료까지의 흐름
- 통신 개시(Connection)
    1. 클라이언트가 서버측에 **SYN** 플래그를 **ON**으로 연결 요청
    (클라이언트 <---> 서버 간 단방향 커넥션 생성)
    2. 서버측은 통신을 잘 받았다는 **ACK** 플래를 클라이언트측에 전송
    (이때, 서버 <---> 클라이언트 간 커넥션 연결을 위해 클라이언트에 SYN 플래그를 ON으로 요청)
    3. 클라이언트측에서 통신을 잘 받았다는 **ACK** 플래그를 서버측에 전송
    (위와 같이 3단계를 통해 비로소 커넥션 연결이 완료됨. 이것을 **3-way handshake**라 함)

- 통신 종료
    1. 클라이언트가 서버측에 커넥션을 종료하겠다고 FIN 플래그 전송
    2. 서버측에서 FIN을 잘 받았다고 ACK를 클라이언트에 전송
    (이때 클라이언트 <---> 서버 간 연결 종료)
    3. 이번엔 서버측이 클라이언트에 커넥션을 종료하겠다고 FIN 플래그 전송
    4. 클라이언트측이 FIN을 잘 받았다고 ACK를 서버에 전송함으로서 모든 커넥션 종료
    (위 4단계를 **4-way handshkae**라고 함)

### 04 UDP가 고속으로 데이터를 전달하는 방법
동영상 스트리밍이나 VoIP 등 데이터 전송의 신뢰성 보다 속도가 우선일 때 UDP 사용

- UDP는 다른 처리 없이 전송만 한다.
- 브로드캐스트와 멀티 캐스트
- 온라인 게임처럼 데이터 전송의 신뢰성과 속도 모두 중요한 경우엔 애플리케이션 계층에서 흐름제어와 혼잡제어를 구현해 신뢰성을 보완한다.